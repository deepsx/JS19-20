/* ---------------------------JQUERY--------------------------- */
//= partials/_jquery.js
/* ---------------------------JCAROUSEL--------------------------- */
;
//= partials/_jquery.jcarousel.js
;
//= partials/_jcarousel.js
;
/* ---------------------------LODASH--------------------------- */
;
//= partials/_lodash.js
;
//= partials/_data.json.js
;
$(function(){
  /* Overlay for service articles */
  var target, $overlay;
  $('.service__article__link').mouseenter(function(e){
    e.stopPropagation();
    $overlay = $('<div class="overlay"></div>');
    $(this).mouseleave(function(){
      $overlay.fadeOut(400, $(this).remove);
    })
    $(this).append($overlay);
    $overlay.fadeIn();
  })
  /* Accordion */
  var $accordion__head = $('.accordion .accordion__panel__head');
  var $accordion__body = $('.accordion .accordion__panel__body');
  $accordion__body.slideUp();
  $accordion__head.removeClass('accordion__panel__head--open');
  $accordion__body.eq(0).slideDown().siblings('.accordion__panel__head').addClass('accordion__panel__head--open');
  $accordion__head.click(function(e){
    if ($(this).hasClass('accordion__panel__head--open')) {
      $(this).toggleClass('accordion__panel__head--open');
      $(this).siblings('.accordion__panel__body').slideToggle(400);
    } else {
      $accordion__body.slideUp(400);
      $accordion__head.removeClass('accordion__panel__head--open');
      $(this).toggleClass('accordion__panel__head--open');
      $(this).siblings('.accordion__panel__body').slideToggle(400);
    }
  })
  // Вторая часть задания
  var skillsArr = _.map(data, 'skills'); // Создаем коллекцию массивов со значениями поля Skills
  skillsArr = _.flattenDeep(skillsArr); // Схлопываем коллекцию в одномерный массив
  skillsArr = _.uniq(skillsArr); // Выбираем только уникальные значения
  skillsArr = skillsArr.sort(); // Сортируем по возрастанию
  console.log('Отсортированный массив скиллов:  ', skillsArr);

  // Создаем коллекцию объектов с полями name и friends
  var friendsCountArr = _.map(data, function(o) {return _.pick(o, 'name', 'friends');});
  // Сортируем коллекцию по длине поля friends
  friendsCountArr = _.sortBy(friendsCountArr, function(o) {return o.friends.length;});
  // Создаем архив по полю name
  friendsCountArr = _.map(friendsCountArr, 'name');
  console.log('Отсортированный массив имен по количеству друзей: ', friendsCountArr);

// Создаем коллекцию массивов с записями поля friends
  var friendsArr = _.map(data, function(o) { // Берем каждый элемент коллекции
    var z = o.friends; // Берем у него поле friends
    return _.map(z, function(z) {
      return z.name; // А из него выбираем все записи поля name
    })});
  // Схлопываем все в одномерный массив
  friendsArr = _.flattenDeep(friendsArr);
  // И выбираем уникальные значения
  friendsArr = _.uniq(friendsArr);
  console.log('Массив друзей: ', friendsArr);
});
